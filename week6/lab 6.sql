show databases;
create database if not exists emp1;
use emp1;
create table project1(pno int, ploc varchar(20),pname varchar(20),primary key(pno));
create table employee1(empno int,ename varchar(20),mgrno int,hiredate date,sal decimal(10,2),deptno int,primary key(empno),foreign key(deptno) references dept1(deptno));
create table dept1(deptno int,dname varchar(20),dloc varchar(20),primary key(deptno));
create table assigned_to(empno int, pno int,job_role varchar(20), primary key(empno,pno),foreign key(empno) references employee(empno),foreign key(pno) references project1(pno));
create table incentives(incentive_date date,empno int,incentive_amount decimal(10,2),primary key(incentive_date,empno),foreign key(empno) references employee(empno));
insert into dept1 values(10,'HR','Bengaluru');
insert into dept1 values(20,'Finance','Hyderabad');
insert into dept1 values(30,'IT','Mysuru');
insert into dept1 values(40,'Sales','Chennai');
insert into dept1 values(50,'Marketing','Delhi');
select * from dept1;
insert into employee1 values(101,'Aarav',106,'2020-03-12',55000.00,10);
insert into employee1 values(102,'Bhavya',106,'2019-06-23',60000.00,20);
insert into employee1 values(103,'Chirag',106,'2021-01-10',48000.00,30);
insert into employee1 values(104,'Diya',101,'2021-11-05',75000.00,40);
insert into employee1 values(105,'Esha',101,'2022-07-15',50000.00,10);
insert into employee1 values(106,'Farhan',102,'2017-05-25',90000.00,30);
insert into employee1 values(107,'Gauri',102,'2019-09-01',68000.00,50);
select * from employee1;

insert into incentives values('2023-01-15',101,3000.00);
insert into incentives values('2023-02-10',102,4000.00);
insert into incentives values('2019-01-05',104,2500.00);
insert into incentives values('2023-04-01',106,5000.00);
insert into incentives values('2019-01-20',107,3500.00);
select * from incentives;
insert into project1 values(501,'Payroll System','Bengaluru');
insert into project1 values(502,'Banking app','Hyderabad');
insert into project1 values(503,'Inventory','Mysuru');
insert into project1 values(504,'Sales tracker','Chennai');
insert into project1 values(505,'AD campaign','Delhi');
insert into project1 values(506,'ERP System','Pune');
select * from project1;
insert into assigned_to values(101,501,'developer');
insert into assigned_to values(102,502,'Analyst');
insert into assigned_to values(103,503,'Tester');
insert into assigned_to values(104,504,'Manager');
insert into assigned_to values(105,505,'Support');
insert into assigned_to values(106,506,'Team lead');
select * from assigned_to;
select m.ename as manager_name,count(e.empno) as no_emp from employee1 e join employee1 m on e.mgrno=m.empno group by m.empno having count(e.empno)=(select max(emp_count) from (select count(mgrno)as emp_count from employee1 where mgrno is not null group by mgrno)as sub);
select m.empno as manager_id,m.ename as manager_name,m.sal as manager_sal from employee1 m where m.empno in (select distinct mgrno from employee1 where mgrno is not null) and m.sal>(select avg(e.sal) from employee1 e where e.mgrno=m.empno);       
select e.deptno,e.ename,e.sal from employee1 e where e.sal=(select max(sal) from employee1 where deptno=e.deptno and sal<(select max(sal) from employee1 where deptno=e.deptno));                        
select e.empno,e.ename,i.incentive_amount from employee1 e join incentives i on e.empno=i.empno where month(i.incentive_date)=01 and year(i.incentive_date)=2019 and i.incentive_amount=(select max(incentive_amount) from incentives where month (incentive_date)=01 and year(incentive_date)=2019 and incentive_amount<(select max(incentive_amount) from incentives where month(incentive_date)=01 and year(incentive_date)=2019));
select e.empno,e.ename,e.deptno from employee1 e join employee1 m on e.mgrno=m.empno where e.deptno=m.deptno;

		